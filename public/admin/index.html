<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

</head>

<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <!-- Load locales after main script -->


  <script>
    // Custom UUID Widget
    var UuidWidget = {
      name: 'uuid',
      controlComponent: createClass({
        componentDidMount: function () {
          if (!this.props.value) {
            this.props.onChange(crypto.randomUUID());
          }
        },
        render: function () {
          return h('input', {
            type: 'text',
            className: this.props.classNameWrapper,
            value: this.props.value,
            disabled: true,
            style: { color: '#ccc', cursor: 'not-allowed' }
          });
        }
      }),
      previewComponent: createClass({
        render: function () {
          return h('div', {}, this.props.value);
        }
      })
    };

    CMS.registerWidget('uuid', UuidWidget.controlComponent, UuidWidget.previewComponent);

    // Register Locale safely
    if (typeof DecapCMSLocales !== 'undefined' && DecapCMSLocales.es) {
      CMS.registerLocale('es', DecapCMSLocales.es);
    } else {
      console.warn('DecapCMSLocales not found, falling back to English');
    }

    // Register Tailwind for Previews
    CMS.registerPreviewStyle("https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css");

    // Helper to render tags
    var TagsPreview = createClass({
      render: function () {
        var tags = this.props.tags || [];
        if (!tags || tags.size === 0) return null;
        return h('div', { className: 'flex flex-wrap gap-2 mt-2' },
          tags.map(function (tag) {
            return h('span', { className: 'bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded' }, tag);
          })
        );
      }
    });

    // Product Preview
    var ProductPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var image = entry.getIn(['data', 'images']);
        var firstImage = image && image.size > 0 ? image.get(0) : '';
        var bgStyle = {
          backgroundImage: 'url(' + firstImage + ')',
          backgroundSize: 'contain',
          backgroundPosition: 'center',
          backgroundRepeat: 'no-repeat',
          height: '300px',
          width: '100%'
        };

        return h('div', { className: 'max-w-2xl mx-auto p-4 bg-white rounded-lg shadow-lg' },
          h('div', { style: bgStyle, className: 'mb-4 rounded-t-lg' }),
          h('div', { className: 'p-4' },
            h('div', { className: 'text-sm text-gray-500 uppercase font-bold tracking-wider' }, entry.getIn(['data', 'brand'])),
            h('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, entry.getIn(['data', 'name'])),
            h('div', { className: 'flex items-baseline gap-4 mb-4' },
              h('span', { className: 'text-2xl font-bold text-green-600' }, 'S/ ' + (entry.getIn(['data', 'price']) || 0).toFixed(2)),
              entry.getIn(['data', 'originalPrice']) ? h('span', { className: 'text-lg text-gray-400 line-through' }, 'S/ ' + entry.getIn(['data', 'originalPrice']).toFixed(2)) : null
            ),
            h('div', { className: 'prose max-w-none text-gray-700 mb-6' }, entry.getIn(['data', 'description'])),
            h('div', { className: 'grid grid-cols-2 gap-4' },
              h('div', {},
                h('h3', { className: 'font-bold mb-2' }, 'Presentaci√≥n'),
                h('p', {}, entry.getIn(['data', 'presentation']))
              ),
              h('div', {},
                h('h3', { className: 'font-bold mb-2' }, 'Categor√≠as'),
                h('div', { className: 'flex flex-wrap gap-1' },
                  (entry.getIn(['data', 'categories']) || []).map(function (cat) {
                    return h('span', { className: 'bg-gray-100 px-2 py-1 rounded text-sm' }, cat);
                  })
                )
              )
            ),
            h(TagsPreview, { tags: entry.getIn(['data', 'tags']) })
          )
        );
      }
    });

    // Hero Preview (archivo individual, no lista)
    var HeroPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var bgClass = entry.getIn(['data', 'bgClass']) || 'bg-gradient-to-br from-green-100 via-emerald-50 to-teal-100';
        
        return h('div', { className: 'p-4' },
          h('h2', { className: 'text-lg font-bold mb-4 text-gray-500' }, 'üì∑ Vista Previa del Slide'),
          h('div', { className: 'relative rounded-xl overflow-hidden p-8 flex items-center bg-gradient-to-br from-green-100 via-emerald-50 to-teal-100', style: { minHeight: '280px' } },
            h('div', { className: 'flex-1 pr-8' },
              h('h2', { className: 'text-3xl font-bold mb-3 text-gray-800' }, entry.getIn(['data', 'title']) || 'T√≠tulo del Slide'),
              h('p', { className: 'text-gray-600 mb-6 text-lg' }, entry.getIn(['data', 'description']) || 'Descripci√≥n del slide'),
              h('a', { 
                href: entry.getIn(['data', 'link']) || '#',
                className: 'inline-block bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-full font-bold shadow-lg'
              }, entry.getIn(['data', 'buttonText']) || 'Ver m√°s')
            ),
            entry.getIn(['data', 'image']) 
              ? h('img', { 
                  src: entry.getIn(['data', 'image']), 
                  className: 'h-52 object-contain drop-shadow-xl',
                  style: { maxWidth: '40%' }
                })
              : h('div', { className: 'h-52 w-52 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400' }, 'üì∑ Imagen')
          ),
          h('div', { className: 'mt-4 p-3 bg-gray-50 rounded-lg text-sm text-gray-500' },
            h('span', { className: 'font-medium' }, 'Enlace: '),
            entry.getIn(['data', 'link']) || 'Sin enlace'
          )
        );
      }
    });

    // Promotions Preview (archivo individual)
    var PromotionsPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var color = entry.getIn(['data', 'color']) || 'orange';
        var colorClasses = {
          'orange': 'from-orange-100 to-orange-200',
          'yellow': 'from-yellow-100 to-yellow-200',
          'red': 'from-red-100 to-red-200'
        };
        var bgClass = colorClasses[color] || colorClasses['orange'];
        
        return h('div', { className: 'p-4' },
          h('h2', { className: 'text-lg font-bold mb-4 text-gray-500' }, 'üè∑Ô∏è Vista Previa de Promoci√≥n'),
          h('div', { className: 'relative rounded-2xl overflow-hidden p-6 flex items-center bg-gradient-to-br ' + bgClass, style: { minHeight: '200px' } },
            h('div', { className: 'relative z-10 flex-1' },
              h('h3', { className: 'text-2xl font-bold mb-2 text-gray-800' }, entry.getIn(['data', 'title']) || 'T√≠tulo'),
              h('p', { className: 'text-md font-medium mb-4 text-gray-600' }, entry.getIn(['data', 'subtitle']) || 'Subt√≠tulo'),
              h('a', { 
                href: entry.getIn(['data', 'link']) || '#',
                className: 'text-md font-bold text-gray-800 underline hover:text-gray-600'
              }, entry.getIn(['data', 'buttonText']) || 'Ver m√°s ‚Üí')
            ),
            entry.getIn(['data', 'image'])
              ? h('img', { 
                  src: entry.getIn(['data', 'image']), 
                  className: 'h-40 w-40 object-contain',
                  style: { transform: 'translateX(10px)' }
                })
              : h('div', { className: 'h-40 w-40 bg-white/50 rounded-lg flex items-center justify-center text-gray-400' }, 'üì∑')
          ),
          h('div', { className: 'mt-4 flex gap-4' },
            h('span', { className: 'px-3 py-1 rounded-full text-sm font-medium bg-gray-100' }, 'Color: ' + color),
            h('span', { className: 'px-3 py-1 rounded-full text-sm font-medium bg-gray-100' }, 'Enlace: ' + (entry.getIn(['data', 'link']) || 'Sin enlace'))
          )
        );
      }
    });

    // Categories Preview
    var CategoriesPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var icon = entry.getIn(['data', 'icon']) || 'üì¶';
        var name = entry.getIn(['data', 'name']) || 'Categor√≠a';
        
        return h('div', { className: 'p-6' },
          h('h2', { className: 'text-lg font-bold mb-4 text-gray-500' }, 'üìÅ Vista Previa de Categor√≠a'),
          h('div', { className: 'flex items-center gap-6 p-6 bg-white rounded-xl shadow-md border border-gray-100' },
            h('div', { className: 'text-5xl' }, icon),
            h('div', {},
              h('h3', { className: 'text-2xl font-bold text-gray-800' }, name),
              h('p', { className: 'text-gray-500 mt-1' }, 'Categor√≠a de productos')
            )
          ),
          h('div', { className: 'mt-6 p-4 bg-gray-50 rounded-lg' },
            h('p', { className: 'text-sm text-gray-500' }, 
              h('span', { className: 'font-medium' }, 'Tip: '),
              'Los productos asociados a esta categor√≠a aparecer√°n en la p√°gina de la categor√≠a.'
            )
          )
        );
      }
    });

    // Site Config Preview
    var SiteConfigPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        
        return h('div', { className: 'p-6 space-y-6' },
          h('h2', { className: 'text-lg font-bold text-gray-500' }, '‚öôÔ∏è Configuraci√≥n del Sitio'),
          
          // Header preview
          h('div', { className: 'bg-white rounded-xl shadow-md p-6 border border-gray-100' },
            h('div', { className: 'flex items-center gap-4 mb-4' },
              entry.getIn(['data', 'logo'])
                ? h('img', { src: entry.getIn(['data', 'logo']), className: 'h-12 object-contain' })
                : h('div', { className: 'h-12 w-12 bg-gray-200 rounded flex items-center justify-center' }, 'üñºÔ∏è'),
              h('div', {},
                h('h1', { className: 'text-2xl font-bold text-gray-800' }, entry.getIn(['data', 'name']) || 'Nombre del Sitio'),
                h('p', { className: 'text-gray-500' }, entry.getIn(['data', 'tagline']) || 'Eslogan')
              )
            ),
            h('p', { className: 'text-gray-600 border-t pt-4 mt-4' }, entry.getIn(['data', 'description']) || 'Descripci√≥n del sitio')
          ),
          
          // Contact info
          h('div', { className: 'grid grid-cols-2 gap-4' },
            h('div', { className: 'bg-green-50 rounded-xl p-4' },
              h('h3', { className: 'font-bold text-green-800 mb-2' }, 'üì± Contacto'),
              h('p', { className: 'text-sm' }, 'üìû ', entry.getIn(['data', 'social', 'phone']) || 'Sin tel√©fono'),
              h('p', { className: 'text-sm' }, 'üí¨ ', entry.getIn(['data', 'social', 'whatsapp']) || 'Sin WhatsApp'),
              h('p', { className: 'text-sm' }, '‚úâÔ∏è ', entry.getIn(['data', 'social', 'email']) || 'Sin email')
            ),
            h('div', { className: 'bg-blue-50 rounded-xl p-4' },
              h('h3', { className: 'font-bold text-blue-800 mb-2' }, 'üìç Direcci√≥n'),
              h('p', { className: 'text-sm' }, entry.getIn(['data', 'address', 'street']) || ''),
              h('p', { className: 'text-sm' }, entry.getIn(['data', 'address', 'city']) || '', ', ', entry.getIn(['data', 'address', 'region']) || ''),
              h('p', { className: 'text-sm' }, entry.getIn(['data', 'address', 'country']) || '')
            )
          ),
          
          // Themes
          h('div', { className: 'bg-purple-50 rounded-xl p-4' },
            h('h3', { className: 'font-bold text-purple-800 mb-2' }, 'üé® Temas'),
            h('div', { className: 'flex gap-4' },
              h('span', { className: 'px-3 py-1 bg-white rounded-full text-sm' }, '‚òÄÔ∏è D√≠a: ', entry.getIn(['data', 'theme']) || 'default'),
              h('span', { className: 'px-3 py-1 bg-gray-800 text-white rounded-full text-sm' }, 'üåô Noche: ', entry.getIn(['data', 'darkTheme']) || 'default')
            )
          ),
          
          // SEO
          h('div', { className: 'bg-orange-50 rounded-xl p-4' },
            h('h3', { className: 'font-bold text-orange-800 mb-2' }, 'üîç SEO'),
            h('p', { className: 'font-medium' }, entry.getIn(['data', 'seo', 'defaultTitle']) || 'T√≠tulo SEO'),
            h('p', { className: 'text-sm text-gray-600 mt-1' }, entry.getIn(['data', 'seo', 'defaultDescription']) || 'Descripci√≥n SEO')
          )
        );
      }
    });

    // Nosotros Preview
    var NosotrosPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var whyUsItems = entry.getIn(['data', 'whyUs', 'items']);
        var valuesItems = entry.getIn(['data', 'values', 'items']);
        
        return h('div', { className: 'space-y-6' },
          // Hero
          h('div', { className: 'relative h-48 bg-gradient-to-r from-green-600 to-emerald-500 rounded-xl overflow-hidden' },
            entry.getIn(['data', 'heroImage'])
              ? h('img', { src: entry.getIn(['data', 'heroImage']), className: 'absolute inset-0 w-full h-full object-cover opacity-30' })
              : null,
            h('div', { className: 'relative z-10 h-full flex flex-col justify-center items-center text-white' },
              h('h1', { className: 'text-4xl font-bold' }, entry.getIn(['data', 'title']) || 'Nosotros'),
              h('p', { className: 'text-lg mt-2 opacity-90' }, entry.getIn(['data', 'subtitle']) || 'Subt√≠tulo')
            )
          ),
          
          // Intro
          h('div', { className: 'p-6 bg-white rounded-xl shadow-sm' },
            h('p', { className: 'text-gray-700 text-lg leading-relaxed' }, entry.getIn(['data', 'intro']) || 'Introducci√≥n')
          ),
          
          // Mission & Vision
          h('div', { className: 'grid grid-cols-2 gap-4' },
            h('div', { className: 'bg-green-50 rounded-xl p-5' },
              h('h3', { className: 'text-xl font-bold text-green-800 mb-2' }, 'üéØ ', entry.getIn(['data', 'mission', 'title']) || 'Misi√≥n'),
              h('p', { className: 'text-gray-700' }, entry.getIn(['data', 'mission', 'content']) || '')
            ),
            h('div', { className: 'bg-blue-50 rounded-xl p-5' },
              h('h3', { className: 'text-xl font-bold text-blue-800 mb-2' }, 'üî≠ ', entry.getIn(['data', 'vision', 'title']) || 'Visi√≥n'),
              h('p', { className: 'text-gray-700' }, entry.getIn(['data', 'vision', 'content']) || '')
            )
          ),
          
          // Why Us
          h('div', { className: 'bg-gray-50 rounded-xl p-5' },
            h('h3', { className: 'text-xl font-bold text-gray-800 mb-4' }, entry.getIn(['data', 'whyUs', 'title']) || '¬øPor qu√© elegirnos?'),
            h('div', { className: 'grid grid-cols-2 gap-3' },
              whyUsItems ? whyUsItems.map(function(item, i) {
                return h('div', { key: i, className: 'bg-white rounded-lg p-3 flex items-start gap-3' },
                  h('span', { className: 'text-2xl' }, item.get('icon') || '‚úì'),
                  h('div', {},
                    h('h4', { className: 'font-bold' }, item.get('title') || ''),
                    h('p', { className: 'text-sm text-gray-600' }, item.get('description') || '')
                  )
                );
              }) : null
            )
          ),
          
          // History
          h('div', { className: 'bg-amber-50 rounded-xl p-5' },
            h('h3', { className: 'text-xl font-bold text-amber-800 mb-3' }, 'üìñ ', entry.getIn(['data', 'history', 'title']) || 'Historia'),
            h('div', { className: 'flex gap-4' },
              entry.getIn(['data', 'history', 'image'])
                ? h('img', { src: entry.getIn(['data', 'history', 'image']), className: 'w-32 h-32 object-cover rounded-lg' })
                : null,
              h('p', { className: 'text-gray-700 flex-1 text-sm' }, 
                (entry.getIn(['data', 'history', 'content']) || '').substring(0, 300) + '...'
              )
            )
          ),
          
          // Values
          h('div', { className: 'bg-purple-50 rounded-xl p-5' },
            h('h3', { className: 'text-xl font-bold text-purple-800 mb-4' }, 'üíé ', entry.getIn(['data', 'values', 'title']) || 'Valores'),
            h('div', { className: 'flex flex-wrap gap-2' },
              valuesItems ? valuesItems.map(function(item, i) {
                return h('div', { key: i, className: 'bg-white rounded-lg px-4 py-2' },
                  h('span', { className: 'font-bold text-purple-700' }, item.get('name') || ''),
                  h('span', { className: 'text-gray-500 text-sm ml-2' }, item.get('description') || '')
                );
              }) : null
            )
          )
        );
      }
    });

    // T√©rminos Preview
    var TerminosPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var secciones = entry.getIn(['data', 'secciones']);
        
        var iconMap = {
          'shopping-cart': 'üõí',
          'credit-card': 'üí≥',
          'truck': 'üöö',
          'package': 'üì¶',
          'tag': 'üè∑Ô∏è',
          'refresh': 'üîÑ',
          'shield': 'üõ°Ô∏è',
          'message': 'üí¨',
          'edit': '‚úèÔ∏è',
          'check': '‚úì'
        };
        
        return h('div', { className: 'space-y-6' },
          // Header
          h('div', { className: 'bg-gradient-to-r from-gray-700 to-gray-900 rounded-xl p-8 text-white' },
            h('h1', { className: 'text-3xl font-bold' }, entry.getIn(['data', 'titulo']) || 'T√©rminos y Condiciones'),
            h('p', { className: 'mt-2 opacity-80' }, entry.getIn(['data', 'subtitulo']) || ''),
            h('p', { className: 'mt-4 text-sm opacity-60' }, 'üìÖ √öltima actualizaci√≥n: ', entry.getIn(['data', 'ultima_actualizacion']) || '')
          ),
          
          // Intro
          h('div', { className: 'bg-blue-50 rounded-xl p-5 border-l-4 border-blue-500' },
            h('p', { className: 'text-gray-700' }, entry.getIn(['data', 'introduccion']) || '')
          ),
          
          // Secciones
          h('div', { className: 'space-y-4' },
            secciones ? secciones.map(function(seccion, i) {
              var iconKey = seccion.get('icono') || 'check';
              var icon = iconMap[iconKey] || 'üìÑ';
              return h('div', { key: i, className: 'bg-white rounded-xl p-5 shadow-sm border border-gray-100' },
                h('div', { className: 'flex items-center gap-3 mb-3' },
                  h('span', { className: 'text-2xl' }, icon),
                  h('h3', { className: 'text-lg font-bold text-gray-800' }, seccion.get('titulo') || 'Secci√≥n')
                ),
                h('div', { className: 'text-gray-600 text-sm prose max-w-none' },
                  (seccion.get('contenido') || '').substring(0, 200) + '...'
                )
              );
            }) : null
          ),
          
          // Nota Final
          entry.getIn(['data', 'nota_final']) ? h('div', { className: 'bg-green-50 rounded-xl p-5 text-center' },
            h('h3', { className: 'font-bold text-green-800 mb-2' }, entry.getIn(['data', 'nota_final', 'titulo']) || ''),
            h('p', { className: 'text-gray-600 mb-4' }, entry.getIn(['data', 'nota_final', 'contenido']) || ''),
            h('button', { className: 'bg-green-600 text-white px-6 py-2 rounded-full font-bold' }, 
              entry.getIn(['data', 'nota_final', 'boton_texto']) || 'Aceptar'
            )
          ) : null
        );
      }
    });

    // Register all preview templates
    CMS.registerPreviewTemplate('products', ProductPreview);
    CMS.registerPreviewTemplate('hero', HeroPreview);
    CMS.registerPreviewTemplate('promotions', PromotionsPreview);
    CMS.registerPreviewTemplate('categories', CategoriesPreview);
    CMS.registerPreviewTemplate('config', SiteConfigPreview);
    CMS.registerPreviewTemplate('nosotros', NosotrosPreview);
    CMS.registerPreviewTemplate('terminos', TerminosPreview);
  </script>
</body>

</html>